import React, { useState, useEffect, useContext } from "react";
import { useNavigate } from "react-router-dom";
import { CartContext } from "../components/CartContext";
import ProductCard from "../components/ProductCard";
import { supabase } from "../pages/SupabaseClient";

import HeroBanner from "../components/Landing/HeroSection";
import BrandStatement from "../components/Landing/BrandStatements";
import Testimonials from "../components/Landing/Testimonials";
import WhyShopWithUs from "../components/Landing/WhyShopWithUs";
import ProductSlider from "../components/Landing/ProductSlider";

import hero3 from "../assets/banners/flowers.jpeg";
import hero4 from "../assets/banners/hero4.jpeg";
import hero5 from "../assets/banners/hero5.jpeg";
import hero6 from "../assets/banners/hero6.jpeg";
import hero7 from "../assets/banners/hero7.jpeg";

import product1 from "../assets/banners/product1banner.png";
import product2 from "../assets/banners/product2banner.png";
import product3 from "../assets/banners/product3banner.png";

import SideBySide from "../components/Landing/SideBySide";
import LandingNavbar from "../components/Landing/LandingNavbar";
import MainBanner from "../components/Landing/MainBanner";
import LandingProductCard from "../components/Landing/LandingProductCard"; // ⭐ BEST SELLER CARD


export default function LandingPage() {
  const { addToCart } = useContext(CartContext);
  const navigate = useNavigate();


  const [bestSellerIndex, setBestSellerIndex] = useState(0);

  const [allProducts, setAllProducts] = useState([]);
  const [featuredProducts, setFeaturedProducts] = useState([]); // ⭐ BEST SELLERS

  const [categories, setCategories] = useState([]);
  const [isLoading, setIsLoading] = useState(true);

  const [windowWidth, setWindowWidth] = useState(window.innerWidth);
  const isMobile = windowWidth < 768;
  const [slideIndex, setSlideIndex] = useState(0);

  const visibleCount = isMobile ? 2 : 4;
  const [selectedCategory, setSelectedCategory] = useState("all");

  // ⭐ BEST SELLERS: IDs 1–8
  const FEATURED_IDS = [1, 2, 3, 4, 5, 6, 7, 8];


  useEffect(() => {
    fetchCategories();
    fetchAllProducts();
    fetchFeaturedProducts(); // ⭐ LOAD BEST SELLERS

    const resizeHandler = () => setWindowWidth(window.innerWidth);
    window.addEventListener("resize", resizeHandler);
    return () => window.removeEventListener("resize", resizeHandler);
  }, []);

  /* --------------------- FETCH CATEGORIES --------------------- */
  async function fetchCategories() {
    const { data } = await supabase.from("categories").select("*");
    setCategories(data || []);
  }

  /* --------------------- FETCH ALL PRODUCTS --------------------- */
  async function fetchAllProducts() {
    setIsLoading(true);

    const { data } = await supabase
      .from("products")
      .select("*")
      .order("created_at", { ascending: false });

    setAllProducts(data || []);
    setIsLoading(false);
  }

  /* --------------------- FETCH BEST SELLER PRODUCTS --------------------- */
  async function fetchFeaturedProducts() {
    const { data, error } = await supabase
      .from("products")
      .select("*")
      .in("product_id", FEATURED_IDS);

    if (error) console.error(error);
    else setFeaturedProducts(data);
  }

  /* --------------------- CATEGORY FILTERING --------------------- */
  const filteredAllProducts =
    selectedCategory === "all"
      ? allProducts
      : allProducts.filter(
          (p) => String(p.category_id) === String(selectedCategory)
        );

  const getVisibleProducts = () => {
    if (filteredAllProducts.length === 0) return [];
    return Array.from({ length: visibleCount }).map(
      (_, i) => filteredAllProducts[(slideIndex + i) % filteredAllProducts.length]
    );
  };

  if (isLoading) {
    return <div style={styles.loader}>Loading products...</div>;
  }

  return (
    <>
      <LandingNavbar />

      {/* --------------------- MAIN HERO BANNER --------------------- */}
      <MainBanner
        heroImages={[
          {
            image: product1,
            title: "Discover elegance for Every Moment",
            subtitle: "Premium Products",
            description: "Thoughtfully curated items elevate your lifestyle.",
            productId: 25,
          },
          {
            image: product2,
            title: "Luxury Meets Comfort",
            subtitle: "Handpicked Items for Your Home",
            description: "Transform your living space into a masterpiece.",
            productId: 31,
          },
          {
            image: product3,
            title: "Style That Inspires",
            subtitle: "Modern Designs for Modern Living",
            description: "Experience beauty, quality, and elegance.",
            productId: 30,
          },
        ]}
      />

      

      {/* --------------------- ALL PRODUCTS SECTION --------------------- */}
      <section style={{ textAlign: "center", marginTop: 40 }}>
        <h2 style={styles.sectionTitle}>All Products</h2>
      </section>

      <section style={{ marginTop: 20, padding: "0 16px" }}>
        {isMobile ? (
          <div style={styles.mobileGrid}>
            {filteredAllProducts.slice(0, 4).map((product) => (
              <div key={product.product_id} style={styles.mobileCardWrapper}>
                <ProductCard product={product} addToCart={addToCart} />
              </div>
            ))}
          </div>
        ) : (
          <div style={styles.sliderRow}>
            {getVisibleProducts().map((product) => (
              <div
                key={product.product_id}
                style={{
                  minWidth: `${100 / visibleCount}%`,
                  padding: "0 8px",
                }}
              >
                <ProductCard product={product} addToCart={addToCart} />
              </div>
            ))}
          </div>
        )}
      </section>

      {/* EXTRA SECTIONS */}
      <section style={{background:"#f9fafb"}}>
      <SideBySide />
      <BrandStatement />
      {/* --------------------- BEST SELLERS SECTION --------------------- */}
<section
  style={{
    width: "100%",
    padding: "60px 0",
    textAlign: "center",
    background: "white",
  }}
>
  <h2
    style={{
      fontSize: "34px",
      fontWeight: "700",
      fontFamily: "Poppins, sans-serif",
      marginBottom: "10px",
      color: "#111",
    }}
  >
    Best Sellers
  </h2>

  <p
    style={{
      fontSize: "16px",
      fontWeight: "400",
      color: "#555",
      maxWidth: "500px",
      margin: "0 auto 40px auto",
      lineHeight: "1.6",
    }}
  >
    Our most loved products, hand-picked and trending right now.
  </p>

  {/* Slider Wrapper */}
  <div style={{ position: "relative", maxWidth: "1400px", margin: "0 auto" }}>
    
    {/* Left Arrow */}
    <button
      onClick={() =>
        setBestSellerIndex((prev) =>
          prev === 0 ? featuredProducts.length - 1 : prev - 1
        )
      }
      style={arrowStyles.left}
    >
      ❮
    </button>

    {/* Slider Row */}
    <div style={styles.sliderRow}>
      {Array.from({ length: visibleCount }).map((_, i) => {
        const product =
          featuredProducts[(bestSellerIndex + i) % featuredProducts.length];

        return (
          <div
            key={product.product_id}
            style={{
              minWidth: `${100 / visibleCount}%`,
              padding: "0 8px",
            }}
          >
            <LandingProductCard product={product} />
          </div>
        );
      })}
    </div>

    {/* Right Arrow */}
    <button
      onClick={() =>
        setBestSellerIndex(
          (prev) => (prev + 1) % featuredProducts.length
        )
      }
      style={arrowStyles.right}
    >
      ❯
    </button>
  </div>
</section>

      <WhyShopWithUs />
      </section>
    </>
  );
}

/* ---------------- Styles ---------------- */
const arrowStyles = {
  left: {
    position: "absolute",
    top: "50%",
    left: 0,
    transform: "translateY(-50%)",
    background: "white",
    border: "1px solid #ddd",
    fontSize: "22px",
    width: "40px",
    height: "40px",
    borderRadius: "50%",
    cursor: "pointer",
    zIndex: 10,
  },
  right: {
    position: "absolute",
    top: "50%",
    right: 0,
    transform: "translateY(-50%)",
    background: "white",
    border: "1px solid #ddd",
    fontSize: "22px",
    width: "40px",
    height: "40px",
    borderRadius: "50%",
    cursor: "pointer",
    zIndex: 10,
  },
};


const styles = {
  loader: {
    height: "100vh",
    display: "flex",
    justifyContent: "center",
    alignItems: "center",
    fontSize: 18,
    color: "#666",
  },

  sectionTitle: {
    fontSize: 28,
    fontWeight: 600,
    marginBottom: 20,
  },

  mobileGrid: {
    display: "grid",
    gridTemplateColumns: "repeat(2, 1fr)",
    gap: "12px",
  },

  mobileCardWrapper: {
    transform: "scale(0.85)",
  },

  sliderRow: {
    display: "flex",
    overflow: "hidden",
  },


};

